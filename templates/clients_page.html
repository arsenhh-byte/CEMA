{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h2>Clients</h2>

    <!-- Live Search Input -->
    <form id="searchForm" class="d-flex mb-4">
        <input id="searchInput" class="form-control me-2" type="search" placeholder="Search clients...">
    </form>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="text-center mb-3" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Clients List -->
    <div id="clientsContainer">
        {% include 'partials/client_list.html' %}
    </div>
</div>

<script>
// Get references
const searchInput = document.getElementById('searchInput');
const clientsContainer = document.getElementById('clientsContainer');
const loadingSpinner = document.getElementById('loadingSpinner');

let debounceTimer; // To hold the timer

// Function to fetch and update clients
function fetchClients(query = '') {
    loadingSpinner.style.display = 'block'; // Show spinner

    fetch(`/clients?search=${encodeURIComponent(query)}`, {
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.text())
    .then(html => {
        clientsContainer.innerHTML = html;
    })
    .finally(() => {
        loadingSpinner.style.display = 'none'; // Always hide spinner
    });
}

// Debounced input event
searchInput.addEventListener('input', function() {
    const searchValue = searchInput.value.trim();

    clearTimeout(debounceTimer); // Reset timer if typing continues
    debounceTimer = setTimeout(() => {
        fetchClients(searchValue); // Only search after 300ms of no typing
    }, 300);
});
</script>
{% endblock %}
